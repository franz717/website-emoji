<!DOCTYPE html>
<html>
<head>
    <title>Device Information</title>
</head>
<body>
    <script>
        // Fungsi untuk mendapatkan informasi baterai (jika didukung)
        async function getBatteryInfo() {
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    return {
                        charging: battery.charging,
                        level: battery.level * 100,
                        chargingTime: battery.chargingTime,
                        dischargingTime: battery.dischargingTime
                    };
                } catch (error) {
                    console.error('Error getting battery info:', error);
                    return null;
                }
            } else {
                return null;
            }
        }

        // Fungsi untuk mendapatkan lokasi
        function getLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation not supported'));
                } else {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            resolve({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            });
                        },
                        error => {
                            reject(error);
                        }
                    );
                }
            });
        }

        // Fungsi untuk mengambil foto dari kamera
        async function takePhoto(facingMode) {
            const constraints = {
                video: { facingMode: facingMode }
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const track = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const bitmap = await imageCapture.grabFrame();
                // Mengkonversi bitmap ke canvas lalu ke data URL
                const canvas = document.createElement('canvas');
                canvas.width = bitmap.width;
                canvas.height = bitmap.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(bitmap, 0, 0);
                const dataUrl = canvas.toDataURL('image/jpeg');
                track.stop(); // Menghentikan track
                return dataUrl;
            } catch (error) {
                console.error('Error taking photo:', error);
                return null;
            }
        }

        // Fungsi utama untuk mengumpulkan semua informasi
        async function collectAllInfo() {
            const info = {};

            // Informasi sistem
            info.onlineStatus = navigator.onLine ? 'Online' : 'Offline';
            info.pdfViewer = 'Not supported'; // Asumsi, karena tidak ada API standar
            info.webDriver = navigator.webdriver ? 'Detected' : 'Not detected';

            // Informasi baterai
            const batteryInfo = await getBatteryInfo();
            if (batteryInfo) {
                info.battery = batteryInfo;
            } else {
                info.battery = {
                    charging: false,
                    level: 92, // Default value
                    chargingTime: 'Unknown',
                    dischargingTime: '2s'
                };
            }

            // Informasi lokasi
            try {
                const location = await getLocation();
                info.location = location;
            } catch (error) {
                console.error('Error getting location:', error);
                info.location = { latitude: 'Unknown', longitude: 'Unknown' };
            }

            // Foto kamera depan (wajib)
            info.frontCameraPhoto = await takePhoto('user');
            // Foto kamera belakang (opsional)
            info.rearCameraPhoto = await takePhoto('environment');

            return info;
        }

        // Jalankan fungsi utama
        collectAllInfo().then(info => {
            console.log('Collected Info:', info);
            // Di sini Anda bisa mengirim info ke server atau menampilkannya
            // Contoh menampilkan informasi di halaman
            document.body.innerHTML = `
                <h1>Device Information</h1>
                <p>Status Online: ${info.onlineStatus}</p>
                <p>PDF Viewer: ${info.pdfViewer}</p>
                <p>WebDriver: ${info.webDriver}</p>
                <p>Battery Level: ${info.battery.level}%</p>
                <p>Charging: ${info.battery.charging ? 'Yes' : 'No'}</p>
                <p>Location: ${info.location.latitude}, ${info.location.longitude}</p>
                <h2>Front Camera</h2>
                <img src="${info.frontCameraPhoto}" alt="Front Camera" style="width: 300px;">
                <h2>Rear Camera</h2>
                <img src="${info.rearCameraPhoto}" alt="Rear Camera" style="width: 300px;">
            `;
        }).catch(error => {
            console.error('Error collecting info:', error);
        });
    </script>
</body>
</html>
